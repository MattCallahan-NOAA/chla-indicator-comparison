---
title: "Chlorophyll indicator comparison"
author: "Matt Callahan"
date: "6/15/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidync)
library(tidyverse)
library(lubridate)
library(sf)
library(httr)
library(flextable)
```




## MODIS
MODIS data were downloaded from a google folder where Jordan stored them from previous efforts https://drive.google.com/drive/u/1/folders/1mhwQ70mjLrkiQYiQ2oNHx08Q7IlL8Q3-

**Import MODIS data**
```{r}
#EBS
mod_ebs<-readRDS("Data/MODIS/merged_8day_2003_2021_EBS.RDS")
#GOA

```

## OC-CCI
**Download 8 day OC-CCI data**
```{r}
#Download one day of grid east of the dateline

#Make lookup table similar to process for VIIRS

#Download BS and GOA rectangles

#clip and merge with new lookup table

```

## VIIRS
We are currently importing viirs into AKFIN, allowing us to process indicators in the database.

## ESP indicators
These indicators were requested by stock assessment authors. Each indicator is a single value for each year.

**Previous ESP Indicator descriptions**
```{r}
#check which indicators were used
data <- httr::content(httr::GET("https://apex.psmfc.org/akfin/data_marts/akmp/esp_indicators?"),
                      type = "application/json"
) %>%
  dplyr::bind_rows()%>%
  filter(grepl('Chlorophylla', INDICATOR_NAME))

#all ours?
unique(data2$CONTACT) #yes

#Descriptions
data%>%group_by(INDICATOR_NAME)%>%
  summarise(unique(PRODUCT_DESCRIPTION))%>%
   flextable()%>%
  theme_box()

```
**AMJ_Chlorophylla_Biomass_SEBS_Satellite**

**Spring_Chlorophylla_Biomass_EGOA_Satellite**

**Spring_Chlorophylla_Biomass_SEBS_Inner_Shelf_Satellite**

**Spring_Chlorophylla_Biomass_SEBS_Satellite**

**Spring_Chlorophylla_Biomass_SMBKC_Satellite**

**Spring_Chlorophylla_Biomass_WCGOA_Satellite**

**Spring_Chlorophylla_Peak_EGOA_Satellite**

**Spring_Chlorophylla_Peak_SEBS_Satellite**

**Spring_Chlorophylla_Peak_WCGOA_Satellite**

**Recalculate ESP indices**
```{r}
mod_ebs<-readRDS("Data/MODIS/merged_8day_2003_2021_EBS.RDS")
```